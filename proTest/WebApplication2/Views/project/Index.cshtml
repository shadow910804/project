@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    List<messages> messageBoard = ViewBag.messages;
    string name = ViewBag.name;
    int ID = ViewBag.ID;
}
<!DOCTYPE html>
<html>

<head>

    <meta charset="UTF-8">

    <title></title>

</head>
<style>
    .stars {
        display: flex;
        cursor: pointer;
    }

    .stars span {
        font-size: 2rem;
        color: gray;
    }

    .stars span.selected {
        color: gold;
    }

    .notNewStars{
        color: gold;
    }

    .pop {
        position: absolute;
        top: 40%;
        left: 50%;
        transform: translate(-50%, -40%);
    }

    .left {
        position: absolute;
        top: 70%;
        left: 35%;
        transform: translate(-35%, -70%);
    }

    .right {
        position: absolute;
        top: 70%;
        left: 65%;
        transform: translate(-65%, -70%);
    }

    #checkDelcover, #checkDelcovers {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.1);
        z-index: 9998;
    }
    #checkHint {
        margin: 0 auto;
        position: absolute;
        top: 45%;
        left: 50%;
        transform: translate(-50%, -45%);
        width: 400px;
        height: 250px;
        background-color: white;
        z-index: 9999;
    }

    #complain {
        margin: 0 auto;
        position: absolute;
        top: 45%;
        left: 50%;
        transform: translate(-50%, -45%);
        width: 400px;
        height: 100%;
        background-color: white;
        z-index: 9999;
    }
    .detail{
        width: 300px;
        height: 400px;
    }
</style>

<body>
    <cover id="cover">
        <div class="show">
            <ol>
            @foreach (messages a in messageBoard)
            {
                @:<li class="messageBase">
                <span class="messageID" style="display: none" name="messageID">@a.messageID</span>
                //訊息編號
                <span style="font-size:15px" name="userName">用戶: @a.userName</span>//用戶名
                <span class="datetime" style="font-size:10px">@a.date.ToString("yyyy/MM/dd HH:mm:ss")</span>
                //留言時間
                <span class="del" style="font-size:15px;color:red">刪除</span>
                <span class="mod" style="font-size:15px">修改</span>
                <span class="complain" style="font-size:15px">檢舉</span>
                <span class="reply" style="font-size:15px">回覆</span><br>
                @if (a.replyID==0) {
                    <sapn>說: </sapn>
                    <span class="messageWords">@a.main</span><br>
                    string star = new string('★',(int)@a.score)+new string('☆',(int)(5-@a.score));
                    <span>評分：</span><span class="notNewStars">@star</span>
                }
                else{
                    <sapn>回覆: </sapn>
                    <span class="messageWords">@a.main</span><br>
                }
                <input class="modThis" style="display: none" placeholder="輸入想修改的內容...">
                <input class="replyThis" style="display: none" placeholder="輸入想回覆的內容...">
                <span class="giveup" style="font-size:15px;display: none">放棄編輯</span>
                <div class="stars modStarRating"></div>
                @:</li>
            }
            </ol>
        </div>
        <hr>
        <div>
            <input id="NewMeessage" type="text" name="main" placeholder="New message">
            <button id="addNewMeessage" type="submit">新增留言</button>
        </div>
        <div class="stars" id="newStarRating">
            <span data-value="1">★</span>
            <span data-value="2">★</span>
            <span data-value="3">★</span>
            <span data-value="4">★</span>
            <span data-value="5">★</span>
        </div>
    </cover>
</body>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/dayjs/1.4.1/dayjs.min.js"></script>
<script>

    //產生留言
    //星級評分(新留言)
    const stars = document.querySelectorAll('#newStarRating span');
    stars.forEach(star => {
        star.addEventListener('click', () => {
            selectedRating = star.getAttribute('data-value');
            stars.forEach(s => s.classList.remove('selected'));
            for (let i = 0; i < selectedRating; i++) {
                stars[i].classList.add('selected');
            }
        });
    });
    let selectedRating = 0;
    function newMessageList() {

        //取得現在時間
        var getNowTime = dayjs().format("YYYY/MM/DD HH:mm:ss");
        //新增留言後立馬取得留言的ID並新增,使用者可能馬上修改留言,ajax改同步執行(async: false)
        var getMessageID=0;
        const catchNewMessage = $("#NewMeessage").val();

        if (selectedRating === 0 || catchNewMessage == "") {
            alert('請選擇星數並填寫留言。');
            return;
        }else{
            var errorMessage = false;
            $.ajax({
                url: "/project/setMessage",
                data: {replyID: 0,userID: @ID,userName: @name,main: catchNewMessage,date: getNowTime,score :selectedRating },
                type: 'GET',
                async: false,
                success: (res) =>{getMessageID=res;},
                error: err => {errorMessage = true;}
            })
            if(errorMessage){
                alert("發生錯誤，請聯絡管理員。");
            }
            else{
                $(".show ol").append(`
                                <li class="messageBase">
                                    <span class="messageID" style="display: none" name="messageID">${getMessageID}</span>
                                    <span style="font-size:15px" name="userName">用戶: ${@name}</span>
                                    <span class="datetime" style="font-size:10px">${getNowTime}</span>
                                    <span class="del" style="font-size:15px;color:red">刪除</span>
                                    <span class="mod" style="font-size:15px">修改</span>
                                    <span class="complain" style="font-size:15px">檢舉</span>
                                    <span class="reply" style="font-size:15px">回覆</span><br>
                                    <sapn>說: </sapn>
                                    <span class="messageWords">${catchNewMessage}</span><br>
                                    <span>評分：</span><span class="notNewStars">${'★'.repeat(selectedRating)}${'☆'.repeat(5 - selectedRating)}</span>
                                    <input class="modThis" style="display: none" placeholder="輸入想修改的內容...">
                                    <input class="replyThis" style="display: none" placeholder="輸入想回覆的內容...">
                                    <span class="giveup" style="font-size:15px;display: none">放棄編輯</span>
                                    <div class="stars modStarRating"></div>
                                </li>`);
                //清空輸入框與星星
                selectedRating = 0;
                stars.forEach(s => s.classList.remove('selected'));
                $('#NewMeessage').val('');
                //新留言的刪除、修改、檢舉、回覆
                $("li:last-child .del").click(del);
                $("li:last-child .mod").click(mod);
                $("li:last-child .complain").click(complain);
                $("li:last-child .reply").click(replyMessage);
                $("li:last-child .giveup").click(giveUp);
            }
        }
    }


    //刪除留言
    function del() {
        let num = $(this).parent().index();

        //彈出視窗以外的部分為透明層，防止其他操作
        overLay();

        //彈出提示視窗確認是否刪除留言
        theHint();
        var popUpWindow = "<span class='pop'>是否刪除留言?</br>提醒您，刪除後無法復原。</span><button class='left' id='userNo'>否</button><button class='right' id='userYes'>是</button>";
        $("#checkHint").html(popUpWindow);

        //點透明層視同取消，移除彈出畫面、透明層
        $("#checkDelcover").on("click",
            () => {
                $("#checkDelcover").remove();
                $("#checkHint").remove();
            });
        $("#userNo").on("click",
            () => {
                $("#checkDelcover").remove();
                $("#checkHint").remove();
            });
        $("#userYes").on("click",
            () => {
                //可能會移除到切版，增加class辨別刪除對象
                $(`li.messageBase:nth-child(${num + 1})`).remove();
                $("#checkDelcover").remove();
                $("#checkHint").remove();

                let i = $(".messageID")[num].textContent;
                $.ajax({
                    url: "/project/delMessage",
                    data: { messageID: i,userID: @ID },
                    type: 'GET',
                    error: err => alert("發生錯誤，請聯絡管理員。"),
                })
            });
    }


    //星級評分(修改留言)
    let modSelectedRating = 0;
    function modStarSelectedColor(){
        var modStars = document.querySelectorAll('.modStarRating span');
        modStars.forEach(star => {
            star.addEventListener('click', () => {
                modSelectedRating = star.getAttribute('data-value');
                modStars.forEach(s => s.classList.remove('selected'));
                for (let i = 0; i < modSelectedRating; i++) {
                    modStars[i].classList.add('selected');
                }
            });
        });
    }
    //修改留言
    //modNum起始設置為(0<)，否則nth-child無法正確選擇
    let modNum=-1;
    function mod() {
        //檢查上回覆是否有輸入值
        if($(`li:nth-child(${replyNum + 1 }) .replyThis`).val() != "" && replyNum!=-1){
            //彈出視窗以外的部分為透明層，防止其他操作
            overLay();

            //彈出提示視窗確認是否放棄上個回覆，如果上個回覆不為空
            theHint();
            var popUpWindow = "<span class='pop'>放棄上個回覆嗎?</br>按'是'後無法復原喔。</span><button class='left' id='userNo'>否</button><button class='right' id='userYes'>是</button>";
            $("#checkHint").html(popUpWindow);

            //點透明層視同取消，移除彈出畫面、透明層
            $("#checkDelcover").on("click",
                () => {
                    $("#checkDelcover").remove();
                    $("#checkHint").remove();
                    $(`li:nth-child(${num + 1}) .modThis`).hide();
                    $(`li:nth-child(${num + 1}) .giveup`).hide();
                });
            $("#userNo").on("click",
                () => {
                    $("#checkDelcover").remove();
                    $("#checkHint").remove();
                    $(`li:nth-child(${num + 1}) .modThis`).hide();
                    $(`li:nth-child(${num + 1}) .giveup`).hide();
                });
            $("#userYes").on("click",
                () => {
                    //清除文字不能用選擇器
                    $(".replyThis")[replyNum].value = "";
                    $(`li:nth-child(${replyNum + 1}) .replyThis`).hide();
                    $(`li:nth-child(${replyNum + 1}) .giveup`).hide();
                    $("#checkDelcover").remove();
                    $("#checkHint").remove();
                    replyNum=-1;
                });
        }else if(replyNum>-1){
                $(`li:nth-child(${replyNum + 1}) .replyThis`).hide();
                $(`li:nth-child(${replyNum + 1}) .giveup`).hide();
                replyNum=-1;
        }

        //修改留言正文
        let num = $(this).parent().index();
        $(`li:nth-child(${num + 1}) .modThis`).show();
        $(`li:nth-child(${num + 1}) .giveup`).show();
        let getThisModText = $(`li:nth-child(${num + 1}) .modThis`).val();
        let i = $(".messageID")[num].textContent;
        //取得現在時間
        var getNowTime = dayjs().format("YYYY/MM/DD HH:mm:ss");
        
        if (getThisModText != '') {
            if (modSelectedRating === 0) {
                alert('請選擇星數並填寫留言。');
                return;}

            var errorMessage = false;

            $.ajax({
            url: "/project/modMessage",
            data: { messageID: i, userID: @ID,main: getThisModText,date: getNowTime,score :modSelectedRating },
            type: 'GET',
            async: false,
            error: err => {errorMessage = true;}
            })
            if(errorMessage){
                alert("發生錯誤，請聯絡管理員。");
            }

            //時間、星數、留言即時更新
            $(`li:nth-child(${num + 1}) .messageWords`).text(getThisModText);
            $(`li:nth-child(${num + 1}) .datetime`).html(getNowTime);
            $(`li:nth-child(${num + 1}) .notNewStars`).html(`${'★'.repeat(modSelectedRating)}${'☆'.repeat(5 - modSelectedRating)}`);
            modSelectedRating = 0;
            modNum=-1;
            $(".modThis")[num].value = "";

            $(`li:nth-child(${num + 1}) .modThis`).hide();
            $(`li:nth-child(${num + 1}) .giveup`).hide();
            $(`ol>li:nth-child(${num + 1}) .modStarRating`).html('');
            return;
        }
        //當選擇修改另一個留言時，檢查上個修改是否有輸入字，並對使用者做出提示，關閉上個修改留言輸入框
        if(modNum>-1){
            if($(`li:nth-child(${modNum + 1}) .modThis`).val() != "" || modSelectedRating!=0){
                //彈出視窗以外的部分為透明層，防止其他操作
                overLay();
                //彈出提示視窗確認是否放棄上個修改，如果上個修改不為空
                theHint();
                var popUpWindow = "<span class='pop'>上個修改尚未完成。</br>按'是'將刪除上個修改，無法復原。</span><button class='left' id='userNo'>否</button><button class='right' id='userYes'>是</button>";
                $("#checkHint").html(popUpWindow);

                //點透明層視同取消，移除彈出畫面、透明層
                $("#checkDelcover").on("click",
                    () => {
                        $("#checkDelcover").remove();
                        $("#checkHint").remove();
                        $(`li:nth-child(${num + 1}) .modThis`).hide();
                        $(`li:nth-child(${num + 1}) .giveup`).hide();
                        $(`ol>li:nth-child(${num + 1}) .modStarRating`).html('');
                    });
                $("#userNo").on("click",
                    () => {
                        $("#checkDelcover").remove();
                        $("#checkHint").remove();
                        $(`li:nth-child(${num + 1}) .modThis`).hide();
                        $(`li:nth-child(${num + 1}) .giveup`).hide();
                        $(`ol>li:nth-child(${num + 1}) .modStarRating`).html('');
                    });
                $("#userYes").on("click",
                    () => {
                        //清除文字不能用選擇器
                        $(".modThis")[modNum].value = "";
                        $(`li:nth-child(${modNum + 1}) .modThis`).hide();
                        $(`li:nth-child(${modNum + 1}) .giveup`).hide();
                        $("#checkDelcover").remove();
                        $("#checkHint").remove();
                        $(`ol>li:nth-child(${modNum + 1}) .modStarRating`).html('');
                        modSelectedRating = 0;
                        modNum=num;
                        modStarSelectedColor();
                    });
            }else if(modNum!=num){
                $(`li:nth-child(${modNum + 1}) .modThis`).hide();
                $(`li:nth-child(${modNum + 1}) .giveup`).hide();
                $(`ol>li:nth-child(${modNum + 1}) .modStarRating`).html('');
            }
        }
        if(modNum!=num){
            $(`ol>li:nth-child(${num + 1}) .modStarRating`).append(`
                <span data-value="1">★</span>
                <span data-value="2">★</span>
                <span data-value="3">★</span>
                <span data-value="4">★</span>
                <span data-value="5">★</span>`)
        }
        if($(`li:nth-child(${modNum + 1}) .modThis`).val() == "" && modSelectedRating==0){
            modNum=num;
        }
        if(modNum==-1){
            modNum=num;
        }
        modStarSelectedColor();
    }


    //放棄編輯(回覆、修改)
    function giveUp(){
        let num = $(this).parent().index();
        if($(`li:nth-child(${num + 1}) .modThis`).val() != '' || $(`li:nth-child(${num + 1 }) .replyThis`).val() != ""){
        //彈出視窗以外的部分為透明層，防止其他操作
        overLay();
        //彈出提示視窗確認是否放棄這則編輯，如果上個這則編輯不為空
        theHint();
        var popUpWindow = "<span class='pop'>是否放棄修改?</br>提醒您，按'是'後無法復原。</span><button class='left' id='userNo'>否</button><button class='right' id='userYes'>是</button>";
        $("#checkHint").html(popUpWindow);

        //點透明層視同取消，移除彈出畫面、透明層
        $("#checkDelcover").on("click",
            () => {
                $("#checkDelcover").remove();
                $("#checkHint").remove();
            });
        $("#userNo").on("click",
            () => {
                $("#checkDelcover").remove();
                $("#checkHint").remove();
            });
        $("#userYes").on("click",
            () => {
                //清除文字不能用選擇器
                $(".modThis")[num].value = "";
                $(".replyThis")[num].value = "";
                $(`li:nth-child(${num + 1}) .replyThis`).hide();
                $(`li:nth-child(${num + 1}) .giveup`).hide();
                $(`li:nth-child(${num + 1}) .modThis`).hide();
                $("#checkDelcover").remove();
                $("#checkHint").remove();
                modNum=-1;
            });
        }else{
                $(`li:nth-child(${num + 1}) .replyThis`).hide();
                $(`li:nth-child(${num + 1}) .giveup`).hide();
                $(`li:nth-child(${num + 1}) .modThis`).hide();
        }
    }


    //檢舉留言
    function complain() {
        //檢舉內容
        let num = $(this).parent().index();
        //獲取文字不能用選擇器，會顯示未定義;
        let str = $(".messageWords")[num].textContent;

        //彈出視窗以外的部分為透明層，防止其他操作
        overLay();

        //彈出視窗確認是否檢舉留言
        var hint = document.createElement('div');
        hint.setAttribute('id', 'complain');
        document.body.appendChild(hint);
        var popUpWindow = `<form action='complainSend' method='post'><p style='display:none' name='content'>${str}</p><input class='harassment' name='harassment' type="checkbox" v-model='com'>騷擾<br><input class='pornography' name='pornography' type="checkbox" v-model='com'>色情內容<br><input class='threaten' name='threaten' type="checkbox" v-model='com'>威脅內容<br><input class='Hatred' name='Hatred' type="checkbox" v-model='com'>仇恨或歧視內容<br><textarea class='detail' placeholder='請輸入內容' name='detail'></textarea><button type='submit' id ='usersend'>寄出</button></form>`;
        $("#complain").html(popUpWindow);

        //點透明層視同取消，移除彈出畫面、透明層
        $("#checkDelcover").on("click",
            () => {
                $("#checkDelcover").remove();
                $("#complain").remove();
            });

        
        function sendData(e) {
            e.preventDefault();
            alert("系統處理中，稍後立馬為您送信(您會收到視窗通知)。")

            let h = document.querySelector(".harassment").checked;
            let p = document.querySelector(".pornography").checked;
            let t = document.querySelector(".threaten").checked;
            let H = document.querySelector(".Hatred").checked;
            let d = $(".detail").val();

            $.ajax({
                url: "project/complainSend",
                data: { content: str, harassment: h, pornography: p, threaten: t, Hatred: H, detail:d },
                type: 'GET',
                success: res => alert("系統已送信請管理員審核！"),
                error: err => alert("發生錯誤，請聯絡管理員。")
            })
        }

        $("#usersend").click(sendData);
    }


    //回覆留言
    //回覆也等同於新增留言，立馬取得留言的ID並新增,使用者可能馬上修改留言,ajax改同步執行(async: false)
    let replyNum=-1;
    function replyMessage(){
        //檢查上修改是否有輸入值
        if($(`li:nth-child(${modNum + 1 }) .modThis`).val() != "" && modNum!=-1){
            //彈出視窗以外的部分為透明層，防止其他操作
            overLay();

            //彈出提示視窗確認是否放棄上個修改，如果上個修改不為空
            theHint();
            var popUpWindow = "<span class='pop'>放棄上個修改嗎?</br>按'是'後無法復原喔。</span><button class='left' id='userNo'>否</button><button class='right' id='userYes'>是</button>";
            $("#checkHint").html(popUpWindow);

            //點透明層視同取消，移除彈出畫面、透明層
            $("#checkDelcover").on("click",
                () => {
                    $("#checkDelcover").remove();
                    $("#checkHint").remove();
                    $(`li:nth-child(${num + 1}) .replyThis`).hide();
                    $(`li:nth-child(${num + 1}) .giveup`).hide();
                });
            $("#userNo").on("click",
                () => {
                    $("#checkDelcover").remove();
                    $("#checkHint").remove();
                    $(`li:nth-child(${num + 1}) .replyThis`).hide();
                    $(`li:nth-child(${num + 1}) .giveup`).hide();
                });
            $("#userYes").on("click",
                () => {
                    //清除文字不能用選擇器
                    $(".modThis")[modNum].value = "";
                    $(`li:nth-child(${modNum + 1}) .modThis`).hide();
                    $(`li:nth-child(${modNum + 1}) .giveup`).hide();
                    $("#checkDelcover").remove();
                    $("#checkHint").remove();
                    $(`ol>li:nth-child(${modNum + 1}) .modStarRating`).html('');
                    modSelectedRating = 0;
                    modNum=-1;
                    modStarSelectedColor();
                });
        }else if(modNum>-1){
                $(`li:nth-child(${modNum + 1}) .modThis`).hide();
                $(`li:nth-child(${modNum + 1}) .giveup`).hide();
                $(`ol>li:nth-child(${modNum + 1}) .modStarRating`).html('');
                modNum=-1;
        }

        //回覆留言正文
        let num = $(this).parent().index();
        $(`li:nth-child(${num + 1}) .replyThis`).show();
        $(`li:nth-child(${num + 1}) .giveup`).show();
        let getThisReplyText = $(`li:nth-child(${num + 1}) .replyThis`).val();
        let i = $(".messageID")[num].textContent;
        //取得現在時間
        var getNowTime = dayjs().format("YYYY/MM/DD HH:mm:ss");
        var getMessageID=0;
        if (getThisReplyText != '') {
            var errorMessage = false;
            $.ajax({
            url: "/project/setMessage",
            data: {replyID: i,userID: @ID,userName: @name,main: getThisReplyText,date: getNowTime },
            type: 'GET',
            async: false,
            success: (res) =>{getMessageID=res;},
            error: err => {errorMessage = true;}
            })
            if(errorMessage){
                alert("發生錯誤，請聯絡管理員。");
            }
            else{
                var newReplyMessage=$("ol>li")[num];
                newReplyMessage.insertAdjacentHTML("afterend",`
                            <li class="messageBase">
                                <span class="messageID" style="display: none" name="messageID">${getMessageID}</span>
                                <span style="font-size:15px" name="userName">用戶: ${@name}</span>
                                <span class="datetime" style="font-size:10px">${getNowTime}</span>
                                <span class="del" style="font-size:15px;color:red">刪除</span>
                                <span class="mod" style="font-size:15px">修改</span>
                                <span class="complain" style="font-size:15px">檢舉</span>
                                <span class="reply" style="font-size:15px">回覆</span><br>
                                <sapn>回覆: </sapn>
                                <span class="messageWords">${getThisReplyText}</span>
                                <input class="modThis" style="display: none" placeholder="輸入想修改的內容...">
                                <input class="replyThis" style="display: none" placeholder="輸入想回覆的內容...">
                                <span class="giveup" style="font-size:15px;display: none">放棄編輯</span>
                            </li>`);
            
                $(`li:nth-child(${num + 2}) .del`).click(del);
                $(`li:nth-child(${num + 2}) .mod`).click(mod);
                $(`li:nth-child(${num + 2}) .complain`).click(complain);
                $(`li:nth-child(${num + 2}) .reply`).click(replyMessage);
                $(`li:nth-child(${num + 2}) .giveup`).click(giveUp);

                $(".replyThis")[num].value = "";
                $(`li:nth-child(${num + 1}) .replyThis`).hide();
                $(`li:nth-child(${num + 1}) .giveup`).hide();
            }
        }
        if(replyNum>-1){
            //當選擇回覆另一個留言時，檢查上個回覆是否有輸入字，並對使用者做出提示，關閉上個回覆留言輸入框
            if($(`li:nth-child(${replyNum + 1 }) .replyThis`).val() != ""){
                //彈出視窗以外的部分為透明層，防止其他操作
                overLay();

                //彈出提示視窗確認是否放棄上個回覆，如果上個回覆不為空
                theHint();
                var popUpWindow = "<span class='pop'>放棄上個回覆嗎?</br>按'是'後無法復原喔。</span><button class='left' id='userNo'>否</button><button class='right' id='userYes'>是</button>";
                $("#checkHint").html(popUpWindow);

                //點透明層視同取消，移除彈出畫面、透明層
                $("#checkDelcover").on("click",
                    () => {
                        $("#checkDelcover").remove();
                        $("#checkHint").remove();
                        $(`li:nth-child(${num + 1}) .replyThis`).hide();
                        $(`li:nth-child(${num + 1}) .giveup`).hide();
                    });
                $("#userNo").on("click",
                    () => {
                        $("#checkDelcover").remove();
                        $("#checkHint").remove();
                        $(`li:nth-child(${num + 1}) .replyThis`).hide();
                        $(`li:nth-child(${num + 1}) .giveup`).hide();
                    });
                $("#userYes").on("click",
                    () => {
                        //清除文字不能用選擇器
                        $(".replyThis")[replyNum].value = "";
                        $(`li:nth-child(${replyNum + 1}) .replyThis`).hide();
                        $(`li:nth-child(${replyNum + 1}) .giveup`).hide();
                        $("#checkDelcover").remove();
                        $("#checkHint").remove();
                        replyNum=num;
                    });
            }else if(replyNum!=num){
                $(`li:nth-child(${replyNum + 1}) .replyThis`).hide();
                $(`li:nth-child(${replyNum + 1}) .giveup`).hide();
            }
        }
        if($(`li:nth-child(${replyNum + 1}) .replyThis`).val() == "" || replyNum<0)
            replyNum=num;
    }


    //透明層
    function overLay(){
        var overlay = document.createElement('div');
        overlay.setAttribute('id', 'checkDelcover');
        cover.appendChild(overlay);
    }

    //提示視窗
    function theHint(){
        var hint = document.createElement('div');
        hint.setAttribute('id', 'checkHint');
        document.body.appendChild(hint);
    }

    //先前留言的刪除、修改、檢舉
    $(".del").click(del);
    $(".mod").click(mod);
    $(".complain").click(complain);
    $(".reply").click(replyMessage);
    $(".giveup").click(giveUp);


    $("#NewMeessage").keypress(e => {
        if (e.keyCode == 13) {
            newMessageList();
        }
    })

    $("#addNewMeessage").click(newMessageList);

</script>

</html>